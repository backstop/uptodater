<?xml version="1.0" encoding="UTF-8" ?>
<project default="rebuild-all" xmlns:m="maven" xmlns:j="jelly:core" xmlns:u="jelly:util">

    <preGoal name="test:test">
        <attainGoal name="unjarDrivers"/>
    </preGoal>
    <goal name="unjarDrivers">
        <unjar dest="${basedir}/target/classes" >
            <fileset dir="${basedir}/drivers">
                <include name="*.jar"/>
            </fileset>
        </unjar>
    </goal>

	<postGoal name="test:test">
		<!-- Delete all non uptodater items, so that the user's drivers are not included in the jar. -->
		<delete>
			<fileset dir="${basedir}/target/classes">
				<exclude name="**/uptodater/**"/>
			</fileset>
		</delete>
	</postGoal>

    <postGoal name="war:webapp">
        <attainGoal name="zipChanges"/>
    </postGoal>
    <goal name="zipChanges">
        <zip destfile="${maven.war.webapp.dir}/WEB-INF/classes/dbupdates.zip">
            <fileset dir="${maven.war.src}/updates">
                <include name="*.sql"/>
            </fileset>
        </zip>
    </goal>

	<goal name="rebuild-all">
		<j:set var="goals" value="clean,jar:jar,war:war,site:generate" />
		<mkdir dir="${maven.build.dir}" />
		<u:tokenize var="goals" delim=",">${goals}</u:tokenize>
		<j:forEach items="${goals}" var="goal" indexVar="goalNumber">
			Now attaining goal number ${goalNumber}, which is ${goal}
			<attainGoal name="${goal}" />
		</j:forEach>
	</goal>

</project>
